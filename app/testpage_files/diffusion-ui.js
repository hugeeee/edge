var diffusion=function(){function e(e){var o;switch(e=parseFloat(e),oc.oddsType){case"traditional":case"decimal":o=e;break;case"us":o=E(e);break;case"winnings":o=e*oc.oddsDefaultStake,o=o.toFixed(2);break;default:o=e}return o=Math.round(100*o)/100}var o="failed",t="odds",n="fodds",i="bestOdds",s="nr",a="position",d=!1;fodds={},failed={},failedPrice={},failedCellClass={},exchangeRates={},currentBestNonExchangeOdds={};var r=15e3,l="",c=function(e){l=e.topic;var o=oc.ssl?"8443":"8080",t=oc.ssl?8443:8080;"D"===oc.release&&(o=oc.ssl?"8444":"9090",t=oc.ssl?8444:9090),DiffusionClient.connect({topic:l,libPath:"/diffusion",onDataFunction:C,onLostConnectionFunction:p,onAbortFunction:v,onCallbackFunction:f,disableXHR:!0,wsURL:"ws"+(oc.ssl?"s":"")+"://"+oc.diffusion.server+":"+o,flashPort:t,flashHost:oc.diffusion.server,flashTimeout:1e4,wsTimeout:5e3,debug:!1,disableIframe:!0,silverlightPort:4503,silverlightHost:oc.diffusion.server})},f=function(e){e?e&&(LOG("Connection? "+e+" topic set: "+l),LOG("User Client ID: "+DiffusionClient.getClientID()+" Transport protocol: "+DiffusionClient.getTransportName())):(LOG("Connection? "+e+" topic set: "+l),setTimeout(function(){diffusion.init({topic:l})},r))},u=function(){},v=function(){},p=function(){setTimeout(u,r)},m=function(e){this.odds=e[2],this.oddsDig=parseFloat(e[3]),this.bestOddsValue=e[4],this.handicapOdds=e[5],this.handicapDigOdds=parseFloat(e[6]),this.oddsNoCommision=e[7],this.oddsDigNoCommision=parseFloat(e[8])},h=function(e,o){this.fodds=parseFloat(e),this.foddsNoCommision=parseFloat(o)},C=function(r){d&&LOG("GetTopic "+r.getTopic()+" Received value: "+w(r));var l,c,f=r.isInitialTopicLoad(),u=r.getTopic(),v=u.split("/"),p=v[5].split("_")[1],C=v[4].split("_")[0],O="",N="",T="",L="",M="",S="";if("market"===C){var $=v[7].split("_")[1],_=x($),k=oc.applyExchangeCommission,I=oc.oddsType,A=v[8],j=p+"_"+$,y=common.getBetButtonObject(p,$),U=common.getOddsCellFromButton(y);if(A===t&&(L=P(r),N=new m(L),T=new h(L[0],L[1])),f)if(A===t){var V=N.odds,W=N.oddsDig;if(!k&&_&&(V=N.oddsNoCommision,W=N.oddsDigNoCommision),_){W=e(W);var K=exchangeRates[p];if("undefined"===K||null===K){var X=G();X[$]=W,exchangeRates[p]=X}else K[$]=W}else if("0"===failed[j]){var q=currentBestNonExchangeOdds[p];"undefined"===q||null===q?currentBestNonExchangeOdds[p]=W:W>q&&(currentBestNonExchangeOdds[p]=W)}if("SP"===V)return U.text(V),void y.removeClass("b");M=T.fodds,!k&&_&&(M=T.foddsNoCommision),M=g(M,I),fodds[j]=M}else{if(A===n)return M=T.fodds,!k&&_&&(M=T.foddsNoCommision),M=g(M,I),void(fodds[j]=M);if(A===o)return failed[j]=w(r),void("1"===failed[j]&&(y.removeClass("o oi oo np bc bs").addClass("o np"),U.text(""),H(p,$,0,currentBestNonExchangeOdds[p],_)))}if("undefined"===y[0]||null===y[0])return;var z=U[0].innerHTML;if(A===t){if(l=$activePanel('.diff-row[data-bid="'+p+'"]'),c=b(l),c||"1"===failed[j])return;var J=N.odds,Q=N.oddsDig;if(!k&&_&&(J=N.oddsNoCommision,Q=N.oddsDigNoCommision),O=N.bestOddsValue,oc.isHandicapGroup&&(S=N.handicapOdds),"SP"===J)return U.text(J),void y.removeClass("b");M=T.fodds,!k&&_&&(M=T.foddsNoCommision),M=g(M,I),fodds[j]=M;var Y=!1;"1"!==O||_||"0"!==failed[j]||oc.isHandicapGroup||"0"===Q||(d&&LOG("UPDATING BEST ODDS BET: "+p+", BOOKIE: "+$+", value:"+Q),currentBestNonExchangeOdds[p]=Q,$activePanel("#best_"+p).text(Q),Y=!0);var Z={};return Z.traditional=J,Z.decimal=Q,"traditional"===I?(d&&LOG("New Odds "+newOdds),F(z,J,Q,y,U,j,O,_,S,Y,Z)):"decimal"===I?B(parseFloat(z),Q,y,U,j,O,_,J,Y,Z):"us"===I?B(parseFloat(z),E(Q),y,U,j,O,_,J,Y,Z):"winnings"===I&&(Q*=oc.oddsDefaultStake,Q=Math.round(100*Q)/100,Q=Q.toFixed(2),B(z,Q,y,U,j,O,_,J,Y,Z)),void H(p,$,Q,currentBestNonExchangeOdds[p],_)}if(A===n){var eo=T.fodds;return!k&&_&&(eo=T.foddsNoCommision),eo=g(eo,I),void(fodds[j]=eo)}if(A===o)return failed[j]=w(r),void("1"===failed[j]?(failedCellClass[j]=y[0].className,y.removeClass("o oi oo np bc bs").addClass("o np"),U.text(""),H(p,$,0,currentBestNonExchangeOdds[p],_),failedPrice[j]=z):"0"===failed[j]&&""===U[0].innerHTML&&(U.text(failedPrice[j]),y[0].className=failedCellClass[j]));if(A===i&&!oc.isHandicapGroup){if("0"===O)y.removeClass("b");else if("1"===O){var oo=U.html();currentBestNonExchangeOdds[p]=parseFloat(oo),$activePanel("#best_"+p).text(oo),y.addClass("b")}return}}else{if("fixture"===C)return void diffusionScoreCard.update(v,r);if(7===v.length){if(v[7]===i){for(var to=w(r),no=to.split(":"),io=no[0],so=no[1].split(","),ao=0,ro=so.length;ro>ao;ao++){var lo=so[ao],co=common.getBetButtonObject(p,lo);"undefined"!==co&&null!==co&&("0"===io?co.removeClass("b"):"1"===io&&co.addClass("b"))}return}if(v[7]===s){var fo=w(r).split(",");if("1"===fo[0]){l=$activePanel('.diff-row[data-bid="'+p+'"]');var uo=l.find(".selTxt"),vo=uo.text();l.removeClass("eventTableRow").addClass("eventTableRowNonRunner"),l.find(".bs").removeClass("bs"),uo.text(vo+" (N/R)"),$activePanel("#best_"+p).text("1000"),D(!0);var po=$activePanel(".eventTableRowNonRunner").length,mo=$activePanel(".diff-row").length;$activePanel(".footerNonRunText").text("Non-Runners: "+po+" / "+mo)}return}if(v[7]===a){var ho=w(r),l=$activePanel('.diff-row[data-bid="'+p+'"]'),Co=l.children(".position-cell");return 0===Co.children(".resultpos").length&&Co.append('<span class="resultpos">'+ho+"<sup>"+R(ho)+"</sup></span>"),void $activePanel(".position-cell-hidden").removeClass("position-cell-hidden")}}}},g=function(e,o){var t=e;return"us"===o?E(t):"winnings"===o?(t*=oc.oddsDefaultStake,t=Math.round(100*t)/100,t.toFixed(2)):t},b=function(e){return e.hasClass("eventTableRowNonRunner")?!0:!1},x=function(e){return"BF"===e||"MA"===e||"BD"===e?!0:!1},O=function(e,o,t){var n="o",i=parseFloat(fodds[t]);e=parseFloat(e),i>0&&e>0&&(i>e?n="oi":e>i?n="oo":i===e&&(n="o")),1===o.length&&o.removeClass("o oi oo np").addClass(n)},B=function(e,o,t,n,i,s,a,d,r,l){O(o,t,i),oc.isHandicapGroup&&(o=d+"<br>"+o),e!==o?T(o,t,n,i,s,a,e,r,l):N(a,s,t)},N=function(e,o,t){e||oc.isHandicapGroup||("1"===o?t.addClass("b"):t.removeClass("b"))},T=function(e,o,t,n,i,s,a,d,r){o.addClass("animating red-on"),setTimeout(function(){oc.isHandicapGroup?t[0].innerHTML=e:(t.text(e),o.attr("data-odig",r.decimal),o.attr("data-o",r.traditional)),N(s,i,o),o.removeClass("red-on"),setTimeout(function(){D(d),"1"===failed[n]&&t.text(""),e.length!==a.length&&oddsTable.setEachWayCellWidths(),o.removeClass("animating")},1e3)},1e3)},D=function(e){!oc.isHandicapGroup&&0===oc.aOSHCstate&&e&&ts_resortTab(oc.aOSHCstate)},F=function(e,o,t,n,i,s,a,d,r,l,c){O(t,n,s),oc.isHandicapGroup&&(o=o+"<br>"+r),e!==o?T(o,n,i,s,a,d,e,l,c):N(d,a,n)},R=function(e){return"1"===e?"st":"2"===e?"nd":"3"===e?"rd":"4"===e?"th":""},w=function(e){var o=e.getFields(0);return o[0]},P=function(e){var o=e.getFields(0),t=o[0].split(":"),n={7:[1,2,3,4,5,0,0,6,7],9:[1,2,3,4,5,6,7,8,9],4:[1,0,2,3,4,0,0,0,0],6:[1,0,2,3,4,5,6,0,0]},i=n[t.length];t.unshift(0);var s=[t[i[0]],t[i[1]],t[i[2]],t[i[3]],t[i[4]],t[i[5]],t[i[6]],t[i[7]],t[i[8]]];return s},G=function(){var e={};return e.MA=0,e.BD=0,e.BF=0,e},H=function(e,o,t,n,i){if(!oc.isHandicapGroup){var s=exchangeRates[e];if((void 0===s||null===s)&&(exchangeRates[e]=G(),s=exchangeRates[e]),i&&failed[e+"_"+o]){var a=exchangeRates[e];a[o]=t,s=exchangeRates[e]}var d=s.MA,r=s.BD,l=s.BF,c=Math.max(t,r,d,l),f=common.getBetButtonObject(e,"MA");c===d&&c>=n?f.addClass("b"):f.removeClass("b"),f=common.getBetButtonObject(e,"BD"),c===r&&c>=n?f.addClass("b"):f.removeClass("b"),f=common.getBetButtonObject(e,"BF"),c===l&&c>=n?f.addClass("b"):f.removeClass("b")}},E=function(e){return e-=1,1>e?e=1/e*-100:e*=100,parseInt(e)};return{init:c,getDataFromDiffusion:w}}();