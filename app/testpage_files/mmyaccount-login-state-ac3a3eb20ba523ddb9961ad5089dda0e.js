/**
 * almond 0.2.0 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

(function(){var e,t,n;(function(r){function p(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."&&t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function d(e,t){return function(){return s.apply(r,h.call(arguments,0).concat([e,t]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){a[e]=t}}function g(e){if(f.hasOwnProperty(e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!a.hasOwnProperty(e)&&!c.hasOwnProperty(e))throw new Error("No "+e);return a[e]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=[].slice;o=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return d(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:b(e)}}},i=function(e,t,n,i){var s,l,h,p,v,y=[],b;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")y[v]=u.require(e);else if(l==="exports")y[v]=u.exports(e),b=!0;else if(l==="module")s=y[v]=u.module(e);else if(a.hasOwnProperty(l)||f.hasOwnProperty(l)||c.hasOwnProperty(l))y[v]=g(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,d(i,!0),m(l),{}),y[v]=a[l]}}h=n.apply(a[e],y);if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!b)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):g(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},15),s)},s.config=function(e){return l=e,s},n=function(e,t,n){t.splice||(n=t,t=[]),f[e]=[e,t,n]},n.amd={jQuery:!0}})(),n("../../node/node_modules/almond/almond",function(){}),n("modules/core/logging",[],function(){function t(e,t,n){this.console=e,this.enabled=t,this.skySite=n}var e={};return t.prototype.debug=function(e){this.log("debug  ",e)},t.prototype.info=function(e){this.log("info   ",e)},t.prototype.notice=function(e){this.log("notice ",e)},t.prototype.warn=function(e){this.log("warn   ",e)},t.prototype.error=function(e){this.log("error  ",e)},t.prototype.log=function(e,t){if(!this.console||!this.enabled)return;var n=this.getSkySiteLogPrefix();n+=e+": "+t,typeof this.console[e.trim()]=="function"?this.console[e.trim()](n):this.console.log(n)},t.prototype.inspect=function(e,t){if(!this.console||!this.enabled)return;var n=this.getSkySiteLogPrefix();n+="inspect: "+t,this.console.log(n,e)},t.prototype.getSkySiteLogPrefix=function(){var e="";return typeof this.skySite!="undefined"&&(e+="["+this.skySite+"] "),e},e.createLog=function(e,n,r){return!e&&typeof window.console=="undefined"&&(e={log:function(){}}),new t(e||window.console,n,r)},e}),n("modules/myaccount/postMessager",[],function(){function t(e,t,n){this.logger=n;if(!e){this.logger.warn("[post-messager] No targetWindow specified, cannot initialise PostMessager");return}if(!t){this.logger.warn("[post-messager] No targetOrigin specified, cannot initialise PostMessager");return}this.targetWindow=e,this.targetOrigin=t}var e={};return e.create=function(e,n,r){return new t(e,n,r)},t.prototype.NAMESPACE_MYACCOUNT="myaccount",t.prototype.TYPE_DEFAULT="Event",t.prototype.TYPE_USER="UserEvent",t.prototype.triggerEvent=function(e,t){this._sendPostMessage(this.TYPE_DEFAULT,{name:e,data:t})},t.prototype.triggerUserEvent=function(e,t){this._sendPostMessage(this.TYPE_USER,{name:e,data:t})},t.prototype._sendPostMessage=function(e,t){var n={type:e,event:t};if(!this.targetOrigin)return this.logger.warn("[post-messager] No targetOrigin set, cannot send postMessage");if(this.targetWindow==undefined)return this.logger.warn("[post-messager] No targetWindow set, cannot send postMessage");if(typeof this.targetWindow.postMessage!="function"&&typeof this.targetWindow.postMessage!="object")return this.logger.warn("[post-messager] No postMessage function, cannot send postMessage");this.logger.inspect(n,"[post-messager] Sending postMessage"),this.targetWindow.postMessage(this.NAMESPACE_MYACCOUNT+JSON.stringify(n),this.targetOrigin)},t.prototype.listen=function(e,t){var n=this,r=function(e){if(e.data.indexOf(n.NAMESPACE_MYACCOUNT)!==0)return;var r=e.data.slice(n.NAMESPACE_MYACCOUNT.length),i;try{i=JSON.parse(r)}catch(s){throw new Error("Invalid JSON received by postMessager")}if(e.origin!=n.targetOrigin)return;t(i,e)};e.addEventListener?e.addEventListener("message",r):e.attachEvent("onmessage",r)},e}),n("modules/myaccount/consumer",["modules/myaccount/postMessager"],function(e){function n(t,n,r){this.receivedMessageHandlers={},this.postMessager=e.create(t,n,r)}var t={};return n.prototype._receiveMessage=function(e,t){if(e.type!==this.postMessager.TYPE_DEFAULT)return;if(this.receivedMessageHandlers.hasOwnProperty(e.event.name)){var n=this.receivedMessageHandlers[e.event.name];for(var r=0;r<n.length;r++)n[r](e.event.data)}},n.prototype.listen=function(e){var t=this;this.postMessager.listen(e,function(e,n){t._receiveMessage.apply(t,[e,n])})},n.prototype.on=function(e,t){this.receivedMessageHandlers.hasOwnProperty(e)==0&&(this.receivedMessageHandlers[e]=[]),this.receivedMessageHandlers[e].push(t)},n.prototype.myaccountPageReady=function(e){return this.postMessager.triggerEvent("myaccountPageReady",e),this},n.prototype.close=function(){return this.postMessager.triggerEvent("closeMyAccount"),this},n.prototype.appLoginAttempted=function(e){return this.postMessager.triggerEvent("appLoginAttempted",e),this},n.prototype.triggerAppBridgeEvent=function(e,t){return this.postMessager.triggerEvent("appbridgeTrigger",{event:e,data:t}),this},n.prototype.appLoginReady=function(){return this.postMessager.triggerEvent("appLoginReady"),this},n.prototype.loggedOut=function(e){return this.postMessager.triggerEvent("loggedOut",e),this},n.prototype.loggedIn=function(e){return this.postMessager.triggerUserEvent("loggedIn",e),this},n.prototype.queueUpEvent=function(e){return this.postMessager.triggerEvent("queueUpEvent",e),this},n.prototype.hasCookies=function(e,t){var n={hasCookies:e};return typeof t!="undefined"&&(n.ssoTransferToken=t),this.postMessager.triggerEvent("hasCookies",n),this},n.prototype.initialPage=function(){return this.postMessager.triggerEvent("initialPage"),this},n.prototype.scrollTo=function(e){return e=e||{value:0},this.postMessager.triggerEvent("scrollTo",e),this},n.prototype.userDataChange=function(e){return this.postMessager.triggerUserEvent("userDataChange",e),this},n.prototype.userStateChange=function(e,t){return this.postMessager.triggerEvent(e,t),this},n.prototype.redeemCode=function(e){return this.postMessager.triggerEvent("redeemCode",e),this},n.prototype.navigate=function(e){return this.postMessager.triggerEvent("navigate",e),this},n.prototype.pageReady=function(e){return this.postMessager.triggerEvent("pageReady",e),this},n.prototype.showModalDialog=function(e){return this.postMessager.triggerEvent("showModalDialog",e),this},n.prototype.setLoadingOverlay=function(e,t){return this.postMessager.triggerEvent("setLoadingOverlay",{value:e?!0:!1,secure:t?!0:!1}),this},n.prototype.getDataForDeposit=function(){return this.postMessager.triggerEvent("getDataForDeposit"),this},t=n,t}),t(["modules/core/logging","modules/myaccount/consumer"],function(e,t){var n=window.clientConfig,r=e.createLog(null,document.cookie.indexOf("Sky_Debug=")!==-1,"identity"),i=new t(window.parent,n.consumer_url,r),s;"secondSsoTransferToken"in n&&(s=n.secondSsoTransferToken),i.hasCookies(document.cookie.length>0,s),n.logged_in&&null!==n.logged_in_user?(r.debug("User already logged into SSO, sending login event"),i.loggedIn({userInteraction:!1,user:n.logged_in_user})):i.loggedOut({userInteraction:!1}),i.initialPage()}),n("mmyaccount-login-state",function(){})})();